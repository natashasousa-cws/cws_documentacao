{
  "name": "Lista Top 3 SKUs mais pedidos",
  "expression": [
    "",
    "VAR CurAcc =",
    "    SELECTEDVALUE ( dClientes[account_id] )",
    "",
    "VAR BaseAccSku =",
    "    SUMMARIZECOLUMNS (",
    "        dClientes[account_id],",
    "        fVendas[sku_id],",
    "        \"Pedidos\",     [Pedidos faturados],",
    "        \"Faturamento\", [Faturamento digital]",
    "    )",
    "",
    "VAR BaseDoCliente =",
    "    FILTER (",
    "        BaseAccSku,",
    "        dClientes[account_id] = CurAcc",
    "            && [Pedidos] > 0",
    "            && NOT ISBLANK ( fVendas[sku_id] )",
    "    )",
    "",
    "VAR Top3 =",
    "    TOPN (",
    "        3,",
    "        BaseDoCliente,",
    "        [Pedidos], DESC,",
    "        [Faturamento], DESC,",
    "        fVendas[sku_id], ASC          -- desempate para garantir exatamente 3 SKUs",
    "    )",
    "",
    "RETURN",
    "IF (",
    "    ISBLANK ( CurAcc ),",
    "    BLANK (),",
    "    CONCATENATEX (",
    "        Top3,",
    "        VAR SkuId = fVendas[sku_id]",
    "        VAR SkuName =",
    "            LOOKUPVALUE (",
    "                dProdutos[sku_name],",
    "                dProdutos[sku_id], SkuId",
    "            )",
    "        VAR NomeOuId =",
    "            IF (",
    "                ISBLANK ( SkuName ) || LEN ( TRIM ( SkuName ) ) = 0,",
    "                SkuId,",
    "                SkuName",
    "            )",
    "        RETURN",
    "            NomeOuId",
    "                & \" — Pedidos: \" & FORMAT ( [Pedidos], \"#,0\" )",
    "                & \" | Faturamento: \" & FORMAT ( [Faturamento], \"R$ #,0.00\" ),",
    "        UNICHAR ( 10 ) & UNICHAR ( 10 ),   -- quebra de linha dupla",
    "        [Pedidos], DESC,",
    "        [Faturamento], DESC,",
    "        fVendas[sku_id], ASC               -- manter a mesma ordenação (com desempate)",
    "    )",
    ")",
    ""
  ],
  "lineageTag": "c9f9dfba-0730-4b04-a7e4-2687e609bdf9"
}