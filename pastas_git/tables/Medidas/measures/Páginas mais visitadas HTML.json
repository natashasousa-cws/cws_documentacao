{
  "name": "Páginas mais visitadas HTML",
  "expression": [
    "",
    "-- =============================================================================================",
    "-- OBJETIVO DA MEDIDA:",
    "-- Cria um visual HTML dinâmico de gráfico de barras horizontais ordenado por visitas.",
    "-- =============================================================================================",
    "-- =============================================================================================",
    "-- PASSO 1: CAPTURAR OS VALORES DAS MEDIDAS",
    "-- =============================================================================================",
    "VAR _homeValue      = COALESCE([Funil - home], 0)",
    "VAR _buscaValue     = COALESCE([Funil - busca], 0)",
    "VAR _produtoValue   = COALESCE([Funil - produto], 0)",
    "VAR _categoriaValue = COALESCE([Funil - categoria], 0)",
    "VAR _lojaValue      = COALESCE([Funil - loja], 0)",
    "VAR _ofertasValue   = COALESCE([Funil - ofertas], 0)",
    "",
    "-- =============================================================================================",
    "-- PASSO 2: CRIAR UMA TABELA VIRTUAL",
    "-- SVGs SUBSTITUÍDOS POR CÓDIGOS VÁLIDOS E ESCAPADOS",
    "-- =============================================================================================",
    "VAR _pagesTable =",
    "    UNION(",
    "        ROW(\"PageName\", \"Home\",       \"Value\", _homeValue,      \"CSSClass\", \"home\",      \"IconSVG\", \"<svg viewBox=\"\"0 0 24 24\"\" fill=\"\"#7b1fa2\"\"><path d=\"\"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z\"\"/></svg>\"),",
    "        ROW(\"PageName\", \"Busca\",      \"Value\", _buscaValue,     \"CSSClass\", \"busca\",     \"IconSVG\", \"<svg viewBox=\"\"0 0 24 24\"\" fill=\"\"#7b1fa2\"\"><path d=\"\"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zM10 14c-2.49 0-4.5-2.01-4.5-4.5S7.51 5 10 5s4.5 2.01 4.5 4.5S12.49 14 10 14z\"\"/></svg>\"),",
    "        ROW(\"PageName\", \"Produtos\",   \"Value\", _produtoValue,   \"CSSClass\", \"produtos\",  \"IconSVG\", \"<svg viewBox=\"\"0 0 24 24\"\" fill=\"\"#7b1fa2\"\"><path d=\"\"M20 7H4V5h16v2zm-1 5H5v-2h14v2zm-4 5H9v-2h6v2z\"\"/></svg>\"),",
    "        ROW(\"PageName\", \"Categorias\", \"Value\", _categoriaValue, \"CSSClass\", \"categoria\", \"IconSVG\", \"<svg viewBox=\"\"0 0 24 24\"\" fill=\"\"#7b1fa2\"\"><path d=\"\"M10 18h5v-6h-5v6zm-6 0h5V5H4v13zm12 0h5v-6h-5v6zM4 5v2h5V5H4zm12 0v2h5V5h-5z\"\"/></svg>\"),",
    "        ROW(\"PageName\", \"Lojas\",      \"Value\", _lojaValue,      \"CSSClass\", \"lojas\",     \"IconSVG\", \"<svg viewBox=\"\"0 0 24 24\"\" fill=\"\"#7b1fa2\"\"><path d=\"\"M12 12c.55 0 1-.45 1-1V6c0-.55-.45-1-1-1s-1 .45-1 1v5c0 .55.45 1 1 1zm-2 8h4v2h-4v-2zm-6 2h4v-2H4v2zM16 2h-8C5.79 2 4 3.79 4 6v13h2V6c0-.55.45-1 1-1h10c.55 0 1 .45 1 1v13h2V6c0-2.21-1.79-4-4-4z\"\"/></svg>\"),",
    "        ROW(\"PageName\", \"Ofertas\",    \"Value\", _ofertasValue,   \"CSSClass\", \"ofertas\",   \"IconSVG\", \"<svg viewBox=\"\"0 0 24 24\"\" fill=\"\"#7b1fa2\"\"><path d=\"\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.77-7-4.14-7-8.1 0-1.98.7-3.83 1.87-5.33L16.5 17.5 12 21.93z\"\"/></svg>\")",
    "    )",
    "    ",
    "-- =============================================================================================",
    "-- PASSO 2.5: CALCULAR O VALOR MÁXIMO PARA A ESCALA",
    "-- =============================================================================================",
    "VAR _maxValue = MAXX(_pagesTable, [Value])",
    "VAR _safeMaxValue = IF(_maxValue = 0, 1, _maxValue)",
    "",
    "-- =============================================================================================",
    "-- PASSO 3: GERAR O HTML DINÂMICO COM CONCATENATEX",
    "-- =============================================================================================",
    "VAR _dynamicHTML =",
    "    CONCATENATEX(",
    "        _pagesTable,",
    "        VAR _currentValue = [Value]",
    "        VAR _percentage = DIVIDE(_currentValue, _safeMaxValue, 0)",
    "        VAR _itemClass = \"page-item \" & [CSSClass] & IF(_currentValue = 0, \" zero-value\", \"\")",
    "        VAR _tooltipText = FORMAT(_currentValue, \"#,##0\") & \" sessões\"",
    "        ",
    "        RETURN",
    "        -- HTML do item de página (estrutura de barra e label)",
    "        \"<div class='\" & _itemClass & \"' title='\" & _tooltipText & \"'>\" &",
    "            \"<div class='step-header'>\" &",
    "                \"<div class='step-title-group'>\" &",
    "                    \"<span class='step-icon'>\" & [IconSVG] & \"</span>\" &",
    "                    \"<span>\" & [PageName] & \"</span>\" &",
    "                \"</div>\" &",
    "                \"<span class='step-value-text'>\" & FORMAT(_currentValue, \"#,##0\") & \"</span>\" &",
    "            \"</div>\" &",
    "            \"<div class='progress-container'>\" &",
    "                \"<div class='progress-bar-background'>\" &",
    "                    \"<div class='funnel-bar' style='width:\" & FORMAT(_percentage, \"0%\") & \";'></div>\" &",
    "                \"</div>\" &",
    "            \"</div>\" &",
    "        \"</div>\",",
    "        \"\", ",
    "        [Value], DESC ",
    "    )",
    "",
    "-- =============================================================================================",
    "-- PASSO 4: MONTAR O HTML FINAL",
    "-- =============================================================================================",
    "RETURN",
    "\"<!DOCTYPE html>",
    "<html lang='pt-br'>",
    "<head>",
    "<meta charset='UTF-8'>",
    "<style>",
    "/* Estilos para o visual 'Páginas Mais Visitadas' */",
    "body { font-family:'Segoe UI',Tahoma,sans-serif; background:#fff; margin:0; padding:8px; color:#333; max-width:830px; box-sizing:border-box;}",
    "h1 { font-size:18px; margin:0 0 10px 0; font-weight:600; color:#202124;}",
    "/* Redução de margem para aproximar as barras */",
    ".page-item { width:100%; margin-bottom:6px; padding:6px; border-radius:6px; transition: background-color 0.2s ease-in-out;}",
    ".page-item:hover { background-color: #F9F9F9; }",
    ".step-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:4px;}",
    ".step-title-group { display:flex; align-items:center; gap:8px; font-size:14px; font-weight:600; color:#333;}",
    ".step-icon { width:16px; height:16px; fill:#7b1fa2;}",
    ".step-value-text { font-size:13px; font-weight:700; color:#202124;}",
    ".progress-container { display:flex; align-items:center; gap:0; }",
    "/* Redução da altura da barra */",
    ".progress-bar-background { height:12px; background:#f1f3f4; border-radius:4px; overflow:hidden; flex-grow:1; border:1px solid #E0E0E0;}",
    ".funnel-bar { height:100%; border-radius:3px; }",
    ".home .funnel-bar { background:linear-gradient(90deg,#1f77b4,#4f95d4); }",
    ".busca .funnel-bar { background:linear-gradient(90deg,#ff7f0e,#ffa54f); }",
    ".produtos .funnel-bar { background:linear-gradient(90deg,#2ca02c,#70c470); }",
    ".categoria .funnel-bar { background:linear-gradient(90deg,#d62728,#e27272); }",
    ".lojas .funnel-bar { background:linear-gradient(90deg,#9467bd,#b699d4); }",
    ".ofertas .funnel-bar { background:linear-gradient(90deg,#8c564b,#b58873); }",
    ".zero-value .funnel-bar { background:#ccc; }",
    "</style>",
    "</head>",
    "<body>",
    "<div class='container'>",
    "  <h1>Páginas Mais Visitadas</h1>\"",
    "& _dynamicHTML &",
    "\"</div>",
    "</body>",
    "</html>\""
  ],
  "displayFolder": "Visuais HTML",
  "lineageTag": "150a400a-1b8e-4e6f-b261-e20ccb66dc0a"
}